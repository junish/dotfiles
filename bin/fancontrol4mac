#!/bin/sh

# 初代MacbookAirのFanを操作するスクリプト

RPM=$1
sudo sh -c 'echo 0 > /sys/devices/platform/applesmc.768/fan1_manual'
if [ "$RPM" != "" ]; then
    # fan control on
    MAX_RPM=`cat /sys/devices/platform/applesmc.768/fan1_max`
    #MIN_RPM=`cat /sys/devices/platform/applesmc.768/fan1_min`
    MIN_RPM=2800
    if [ $RPM -lt $MIN_RPM ]; then
        RPM=$MIN_RPM
    fi
    if [ $MAX_RPM -lt $RPM ]; then
        RPM=$MAX_RPM
    fi
    sudo sh -c 'echo 1 > /sys/devices/platform/applesmc.768/fan1_manual'
    sudo sh -c "echo $RPM > /sys/devices/platform/applesmc.768/fan1_output"
fi
