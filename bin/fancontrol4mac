#!/bin/sh

# 初代MacbookAirのFanを操作するスクリプト

RPM=$1
if [ "$RPM" == "" ]; then
    # fan control off
    sudo su -c 'echo 0 > /sys/devices/platform/applesmc.768/fan1_manual'
else
    # fan control on
    MAX_RPM=`cat /sys/devices/platform/applesmc.768/fan1_max`
    MIN_RPM=`cat /sys/devices/platform/applesmc.768/fan1_min`
    [ $RPM -lt $MIN_RPM ] && RPM=$MIN_RPM
    [ $MAX_RPM -lt $RPM ] && RPM=$MAX_RPM
    sudo su -c 'echo 1 > /sys/devices/platform/applesmc.768/fan1_manual'
    sudo su -c "echo $RPM > /sys/devices/platform/applesmc.768/fan1_output"
fi
